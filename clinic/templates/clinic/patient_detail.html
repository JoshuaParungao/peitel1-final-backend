{% extends 'clinic/base.html' %}
{% block content %}

<div class="card" style="max-width:1100px;margin:20px auto;padding:18px;">
    <div style="display:flex;justify-content:space-between;align-items:start;gap:16px;flex-wrap:wrap">
        <div style="flex:1;min-width:280px">
            <h2 style="margin-top:0">{{ patient.first_name }} {{ patient.last_name }}</h2>
            <p><strong>Contact:</strong> {{ patient.contact_number|default:'—' }}</p>
            <p><strong>Email:</strong> {{ patient.email|default:'—' }}</p>
            <p><strong>Address:</strong> {{ patient.address|linebreaksbr|default:'—' }}</p>
            <p><strong>Added:</strong> <small class="text-muted">{{ patient.created_at|date:"M d, Y H:i" }}</small></p>
        </div>

        <div style="min-width:220px">
            <div style="background:var(--surface);padding:12px;border-radius:8px;box-shadow:var(--shadow)">
                <p style="margin:0"><strong>Total Invoices</strong></p>
                <p style="font-size:20px;margin:4px 0">{{ invoices.count }}</p>
                <a href="{% url 'clinic:patient_update' patient.pk %}" class="btn" style="display:inline-block;margin-top:8px">Edit Patient</a>
            </div>
        </div>
    </div>

    <hr style="margin:16px 0">

    <h3 style="margin-bottom:8px">Services Acquired</h3>
    {% if services_summary %}
        <table class="table">
            <thead>
                <tr><th>Service</th><th>Quantity</th><th>Total Spent</th></tr>
            </thead>
            <tbody>
                {% for s in services_summary %}
                    <tr>
                        <td>{{ s.name }}</td>
                        <td>{{ s.quantity }}</td>
                        <td>₱{{ s.total|floatformat:2 }}</td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted">No services recorded for this patient.</p>
    {% endif %}

    <hr style="margin:16px 0">

    <h3 style="margin-bottom:8px">Invoices</h3>
    {% if invoices %}
        <table class="table">
            <thead>
                <tr><th>ID</th><th>Date</th><th>Paid</th><th>Total</th><th>Actions</th></tr>
            </thead>
            <tbody>
                {% for invoice in invoices %}
                    <tr>
                        <td>#{{ invoice.pk }}</td>
                        <td>{{ invoice.date_created|date:"M d, Y H:i" }}</td>
                        <td>{% if invoice.is_paid %}<span class="badge success-badge">Yes</span>{% else %}<span class="badge danger-badge">No</span>{% endif %}</td>
                        <td>₱{{ invoice.total_amount|floatformat:2 }}</td>
                        <td>
                            <a class="btn secondary-btn btn-sm" href="{% url 'clinic:invoice_detail' invoice.pk %}">View</a>
                            <a class="btn btn-sm" href="{% url 'clinic:invoice_update' invoice.pk %}">Edit</a>
                        </td>
                    </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p class="text-muted">No invoices for this patient.</p>
    {% endif %}

    <div style="margin-top:16px">
        <a href="{{ back_url }}" class="btn secondary-btn">Back to Dashboard</a>
    </div>
</div>

<style>
.text-muted { color:var(--muted); }
.badge { padding:4px 8px;border-radius:6px;color:#fff }
.success-badge { background:#28a745 }
.danger-badge { background:#dc3545 }
.secondary-btn { background:#6c757d;color:#fff;padding:6px 10px;border-radius:6px;text-decoration:none }
.btn-sm { font-size:12px;padding:4px 8px }
</style>

{% endblock %}
